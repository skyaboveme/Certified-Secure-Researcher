---
import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

const allPosts = await getCollection("blog");
allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const categoryEmojis: Record<string, string> = {
	"Risk Assessment": "üí∞",
	"Research Security": "üö®",
	"Security Analysis": "üîê",
	Compliance: "üìä",
	"Best Practices": "üîí",
	"Industry News": "üåê",
	Guidelines: "üìã",
	Tips: "üí°",
	General: "üìù",
};

function getEmoji(category: string) {
	return categoryEmojis[category] || "üìù";
}
---

<BaseLayout
	title="Research Security Blog | Certified Secure Researcher‚Ñ¢"
	description="Expert insights on research security compliance, IP theft prevention, NSPM-33 requirements, and ORCID security. Stay updated on federal regulations and certification best practices."
	keywords="research security blog, IP theft prevention, NSPM-33 compliance, ORCiD security, research compliance updates, federal research regulations, insider threat prevention"
	type="blog"
>
	<Header currentPage="blog" />

	<!-- Page Hero -->
	<section class="page-hero">
		<div class="container">
			<h2>Research Security Blog</h2>
			<p>
				Official updates on research security compliance, regulatory
				changes, and certification best practices
			</p>
		</div>
	</section>

	<!-- Blog Posts -->
	<section class="section">
		<div class="container">
			<div class="blog-grid">
				{
					allPosts.map((post) => (
						<article class="blog-card">
							<div class="blog-image">
								<div class="placeholder-image">
									{getEmoji(post.data.category)}
								</div>
							</div>
							<div class="blog-content">
								<div class="blog-meta">
									<span class="blog-category">
										{post.data.category}
									</span>
									<span class="blog-date">
										{post.data.pubDate.toLocaleDateString(
											"en-US",
											{
												year: "numeric",
												month: "long",
												day: "numeric",
											},
										)}
									</span>
								</div>
								<h3>{post.data.title}</h3>
								<p>{post.data.description}</p>
								<a
									href={`/blog/${post.slug}`}
									class="read-more"
								>
									Read More ‚Üí
								</a>
							</div>
						</article>
					))
				}
			</div>
		</div>
	</section>

	<!-- Newsletter CTA -->
	<section class="section bg-light">
		<div class="container">
			<div class="newsletter-box">
				<h3>Subscribe to Updates</h3>
				<p>
					Receive official notifications on research security
					compliance changes and certification updates.
				</p>
				<form class="newsletter-form">
					<input
						type="email"
						placeholder="Enter your institutional email"
						required
					/>
					<button type="submit" class="btn btn-primary"
						>Subscribe</button
					>
				</form>
			</div>
		</div>
	</section>

	<Footer />
</BaseLayout>

<style>
	.page-hero {
		background: var(--primary);
		padding: 4rem 0;
		text-align: center;
		color: white;
		border-bottom: 4px solid var(--accent);
	}

	.page-hero h2 {
		font-size: 2.5rem;
		margin-bottom: 1rem;
		color: white;
	}

	.page-hero p {
		font-size: 1.125rem;
		color: white;
		max-width: 700px;
		margin: 0 auto;
	}

	.section {
		padding: 4rem 0;
	}

	.bg-light {
		background: var(--bg);
	}

	.blog-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
		gap: 2rem;
	}

	.blog-card {
		background: white;
		border-radius: 0;
		overflow: hidden;
		border: 2px solid var(--light-gray);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
		transition:
			transform 0.3s,
			box-shadow 0.3s,
			border-color 0.3s;
		display: flex;
		flex-direction: column;
	}

	.blog-card:hover {
		transform: translateY(-4px);
		box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
		border-color: var(--primary);
	}

	.blog-card.featured {
		border-color: var(--accent);
		border-width: 3px;
	}

	.blog-card.featured:hover {
		border-color: var(--primary);
	}

	.blog-image {
		background: var(--bg);
		height: 180px;
		display: flex;
		align-items: center;
		justify-content: center;
		border-bottom: 2px solid var(--light-gray);
	}

	.placeholder-image {
		font-size: 3.5rem;
	}

	.blog-content {
		padding: 1.5rem;
		flex: 1;
		display: flex;
		flex-direction: column;
	}

	.blog-meta {
		display: flex;
		justify-content: space-between;
		align-items: center;
		margin-bottom: 1rem;
		font-size: 0.8125rem;
	}

	.blog-category {
		background: var(--primary);
		color: white;
		padding: 0.25rem 0.75rem;
		border-radius: 0;
		font-weight: 700;
		text-transform: uppercase;
		letter-spacing: 0.05em;
	}

	.blog-date {
		color: var(--gray);
		font-weight: 600;
	}

	.blog-content h3 {
		font-size: 1.125rem;
		margin-bottom: 0.75rem;
		color: var(--dark);
		line-height: 1.4;
	}

	.blog-content p {
		color: var(--gray);
		line-height: 1.6;
		margin-bottom: 1rem;
		flex: 1;
	}

	.read-more {
		color: var(--primary);
		font-weight: 700;
		text-decoration: none;
		transition: color 0.2s;
		display: inline-block;
		margin-top: auto;
	}

	.read-more:hover {
		color: var(--primary-dark);
		text-decoration: underline;
	}

	.newsletter-box {
		background: white;
		padding: 3rem;
		border-radius: 0;
		text-align: center;
		max-width: 600px;
		margin: 0 auto;
		border: 2px solid var(--primary);
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
	}

	.newsletter-box h3 {
		font-size: 1.5rem;
		margin-bottom: 1rem;
		color: var(--dark);
	}

	.newsletter-box p {
		color: var(--gray);
		margin-bottom: 1.5rem;
	}

	.newsletter-form {
		display: flex;
		gap: 1rem;
	}

	.newsletter-form input {
		flex: 1;
		padding: 0.75rem 1rem;
		border: 2px solid var(--light-gray);
		border-radius: 0;
		font-size: 1rem;
	}

	.newsletter-form input:focus {
		outline: none;
		border-color: var(--primary);
	}

	@media (max-width: 768px) {
		.page-hero h2 {
			font-size: 2rem;
		}

		.blog-grid {
			grid-template-columns: 1fr;
		}

		.newsletter-form {
			flex-direction: column;
		}
	}
</style>
